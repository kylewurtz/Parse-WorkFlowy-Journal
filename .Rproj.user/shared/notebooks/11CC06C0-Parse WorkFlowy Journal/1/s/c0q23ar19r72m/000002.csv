"0","# get total pomodoros from a day"
"0","getTotPom = function(t, n) {"
"0","  t = xml_child(t, n)"
"0","  t %<>% xml_attr(""text"") %>% str_split("":"")"
"0","  t = t[[1]][2] %>% str_trim() %>% as.integer()"
"0","  return(t)"
"0","}"
"0","getDaysPomodoros = function(day) {"
"0","  # get pretty date"
"0","  date = getDate(day)"
"0","  "
"0","  # get pomodoros in day"
"0","  poms = xml_children(day)[1]"
"0","  "
"0","  # pomodoros total"
"0","  poms_tot = xml_child(poms, 1)"
"0","  poms_tot_w = getTotPom(poms_tot, 1) # work"
"0","  poms_tot_g = getTotPom(poms_tot, 2) # growth"
"0","  poms_tot_h = getTotPom(poms_tot, 3) # health"
"0","  poms_tot_m = getTotPom(poms_tot, 4) # misc"
"0","  "
"0","  # if no pomodoros, can skip the rest of this"
"0","  if(!(is.na(poms_tot_w) & is.na(poms_tot_g) & is.na(poms_tot_h) & is.na(poms_tot_m))) {"
"0","    # only proceed if they're not all NAs"
"0","    # pomodoro records"
"0","    pom_records = data_frame("
"0","      date = rep(date, 100),"
"0","      id = 1:100,"
"0","      type = rep(NA, 100),"
"0","      proj = rep(NA, 100),"
"0","      proj_count = rep(NA, 100),"
"0","      desc = rep(NA, 100)"
"0","    )"
"0","    "
"0","    # loop through each of pomodoros and log it"
"0","    for (r in 2:length(xml_children(poms))) {"
"0","      n = r - 1"
"0","      "
"0","      # get individual record"
"0","      pom_rec = xml_child(poms, r) %>%"
"0","        xml_child() %>%"
"0","        xml_attr(""text"") %>%"
"0","        str_split("":"", 2) %>%"
"0","        .[[1]] %>%"
"0","        str_trim()"
"0","      "
"0","      # get pomodoro type"
"0","      pom_rec_type = pom_rec[1]"
"0","      "
"0","      # get pomodoro description"
"0","      pom_rec_desc = pom_rec[2]"
"0","      "
"0","      # get project type (if applicable)"
"0","      proj_check = pom_rec_desc %>%"
"0","        str_split(""@"") %>%"
"0","        .[[1]] %>%"
"0","        length()"
"0","      if (proj_check == 2) {"
"0","        pom_rec_proj = pom_rec_desc %>%"
"0","          str_split(""@"") %>%"
"0","          .[[1]] %>%"
"0","          .[2] %>%"
"0","          str_split("" "") %>%"
"0","          .[[1]] %>%"
"0","          .[1]"
"0","        "
"0","        if (grepl(""\\["", pom_rec_desc)) {"
"0","          pom_rec_proj_count = pom_rec_desc %>%"
"0","            str_split(""\\["", 2) %>%"
"0","            .[[1]] %>%"
"0","            .[2] %>%"
"0","            str_split(""\\]"", 2) %>%"
"0","            .[[1]] %>%"
"0","            .[1] %>%"
"0","            as.integer()"
"0","          "
"0","          pom_rec_desc %<>%"
"0","            str_split(""]"") %>%"
"0","            .[[1]] %>%"
"0","            .[2] %>%"
"0","            str_trim()"
"0","        } else {"
"0","          pom_rec_proj_count = NA"
"0","        }"
"0","        "
"0","        proj_bool = pom_rec_desc %>%"
"0","          str_split("" "") %>%"
"0","          .[[1]] %>%"
"0","          grepl(""@"", .)"
"0","        pom_rec_desc %<>%"
"0","          str_split("" "") %>%"
"0","          .[[1]] %>%"
"0","          subset(!proj_bool) %>%"
"0","          paste(collapse = "" "")"
"0","        "
"0","      } else {"
"0","        pom_rec_proj = NA"
"0","        pom_rec_proj_count = NA"
"0","      }"
"0","      "
"0","      # add results to pom_records"
"0","      pom_records$type[n] = pom_rec_type"
"0","      pom_records$proj[n] = pom_rec_proj"
"0","      pom_records$proj_count[n] = pom_rec_proj_count"
"0","      pom_records$desc[n] = pom_rec_desc"
"0","    }"
"0","  "
"0","    # filter out extra rows"
"0","    pom_records %<>% filter(!is.na(type))"
"0","    "
"0","    # add to pomodoros data frame"
"0","    pomodoros %<>% rbind(pom_records)"
"0","    "
"0","    # add totals to days data frame"
"0","    days$poms_tot[days$day == date] = nrow(pom_records)"
"0","    days$poms_tot_w[days$day == date] = pom_records %>% filter(type == ""W"") %>% nrow()"
"0","    days$poms_tot_g[days$day == date] = pom_records %>% filter(type == ""G"") %>% nrow()"
"0","    days$poms_tot_h[days$day == date] = pom_records %>% filter(type == ""H"") %>% nrow()"
"0","    days$poms_tot_m[days$day == date] = pom_records %>% filter(type == ""M"") %>% nrow()"
"0","    "
"0","    # save results to global environment"
"0","    assign(""days"", days, envir = .GlobalEnv)"
"0","    assign(""pomodoros"", pomodoros, envir = .GlobalEnv)"
"0","  }"
"0","}"
